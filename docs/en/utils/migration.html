<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data &amp; ICTs - 30 day map challenge day 1 and 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data &amp; ICTs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About me</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../en" rel="" target="">
 <span class="menu-text">English</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../es" rel="" target="">
 <span class="menu-text">Español</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prompt" id="toc-prompt" class="nav-link active" data-scroll-target="#prompt">Prompt</a></li>
  <li><a href="#day-map-challenge-day-3-and-4" id="toc-day-map-challenge-day-3-and-4" class="nav-link" data-scroll-target="#day-map-challenge-day-3-and-4">30 day map challenge day 3 and 4</a></li>
  <li><a href="#cables-submarinos-de-internet" id="toc-cables-submarinos-de-internet" class="nav-link" data-scroll-target="#cables-submarinos-de-internet">Cables Submarinos De Internet</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">30 day map challenge day 1 and 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> load_dotenv()</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>openai.api_key  <span class="op">=</span> os.getenv(<span class="st">'OPENAI_KEY'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List available models</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>[<span class="bu">print</span>(model.<span class="bu">id</span>) <span class="cf">for</span> model <span class="kw">in</span> openai.models.<span class="bu">list</span>()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gpt-3.5-turbo-0301
text-embedding-3-large
gpt-4-turbo-preview
dall-e-3
whisper-1
dall-e-2
text-embedding-ada-002
tts-1-hd-1106
tts-1-hd
davinci-002
babbage-002
text-embedding-3-small
gpt-4-0125-preview
gpt-3.5-turbo-0613
gpt-3.5-turbo
gpt-4-0613
gpt-4-vision-preview
gpt-3.5-turbo-16k-0613
gpt-4
gpt-3.5-turbo-1106
tts-1-1106
gpt-3.5-turbo-instruct
tts-1
gpt-3.5-turbo-instruct-0914
gpt-4-1106-preview
gpt-3.5-turbo-16k</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>[None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None,
 None]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="st">"gpt-3.5-turbo-16k"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_completion(prompt, model<span class="op">=</span>model):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> openai.chat.completions.create(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>messages,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="dv">0</span>, <span class="co"># this is the degree of randomness of the model's output</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>posteo_espanol_ejemplo <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">title: Usando Whisper para Transcribir a Messi</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">author: Martin Olmos</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">date: '2023-02-03'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">slug: []</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">categories:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">  - NLP</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">  - IA</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">  - ML</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">tags:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">  - Whisper</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">  - Messi</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">[Whisper]('https://openai.com/blog/whisper/') es un modelo de código abierto para reconocimiento del habla desarrollado por [OpenAI](https://openai.com).</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="st">Intentaremos utilizarlo para agregar subtítulos a una entrevista reciente.</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="st">Aquí la entrevista original:</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/RYXcR3YejwY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen&gt;&lt;/iframe&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="st">## Descargo el audio y el video de Youtube</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="st">import youtube_dl as ydl</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="st">video_url = 'https://www.youtube.com/watch?v=RYXcR3YejwY'</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_audio_opts = {</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="st">    'format': 'bestaudio/best',</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="st">    'postprocessors': [{</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="st">        'key': 'FFmpegExtractAudio',</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredcodec': 'mp3',</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredquality': '192'}]</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_video_opts = {</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_audio_opts).download([video_url])</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_video_opts).download([video_url])</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="st">## Genero la transcripción</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="st">import whisperx</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="st">device = "cuda" </span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="st">audio_file = "whisper_messi_corto.mp3"</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="st"># transcribe with original whisper</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="st">model = whisperx.load_model("large-v2", device)</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="st">result = model.transcribe(audio_file)</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="st">print(result["segments"]) # before alignment</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="st"># load alignment model and metadata</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="st">model_a, metadata = whisperx.load_align_model(language_code=result["language"], device=device)</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="st"># align whisper output</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="st">result_aligned = whisperx.align(result["segments"], model_a, metadata, audio_file, device)</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="st">## Incrusto la transcripción en el video como subtítulos</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="st">import pandas as pd</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="st">import cv2</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import VideoFileClip</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="st">import moviepy.editor as mp</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import *</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.video.tools.subtitles import SubtitlesClip</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="st">dict1 = {'start':[], 'end':[], 'text':[]}</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="st">for i in result_aligned['segments']:</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['start'].append(int(i['start']))</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['end'].append(int(i['end']))</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['text'].append(i['text'])</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="st">df = pd.DataFrame.from_dict(dict1)</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="st">df.to_csv(f'whisper_messi_corto_subs.csv')</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="st">videocap = cv2.VideoCapture("whisper_messi_corto.mp4")</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="st">success, image = videocap.read()</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="st">height = image.shape[0]</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="st">width =image.shape[1]</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="st">generator = lambda txt: TextClip(txt, font='P052-Bold', fontsize=width/50, stroke_width=.7, color='white', stroke_color = 'black', size = (width, height*.25), method='caption')</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="st">subs = tuple(zip(tuple(zip(df['start'].values, df['end'].values)), df['text'].values))</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="st">subtitles = SubtitlesClip(subs, generator)</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="st">video = VideoFileClip('whisper_messi_corto.mp4')</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="st">final = CompositeVideoClip([video, subtitles.set_pos(('center','bottom'))])</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="st">final.write_videofile('whisper_messi_corto_con_subs.mp4', fps=video.fps, remove_temp=True, codec="libx264", audio_codec="aac")</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="st">Aquí el producto final, el video con los subtítulos:</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;video width="640" height="480" controls&gt;</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;source src="whisper_messi_corto_con_subs.mp4" type="video/mp4"&gt;</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/video&gt;</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>posteo_ingles_ejemplo <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">title: Using Whisper to Transcribe Messi</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">author: Martin Olmos</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">date: '2023-02-03'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">slug: []</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">categories:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st">  - NLP</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">  - IA</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">  - ML</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">tags:</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">  - Whisper</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">  - Messi</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st">[Whisper]('https://openai.com/blog/whisper/') is an open source model for speech recognition developed by [OpenAI](https://openai.com).</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="st">We will try to use it to add subtitles to a recent interview.</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="st">Here is the original interview:</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/RYXcR3YejwY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen&gt;&lt;/iframe&gt;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="st">## Download audio and video from Youtube</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="st">import youtube_dl as ydl</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="st">video_url = 'https://www.youtube.com/watch?v=RYXcR3YejwY'</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_audio_opts = {</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="st">    'format': 'bestaudio/best',</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="st">    'postprocessors': [{</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="st">        'key': 'FFmpegExtractAudio',</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredcodec': 'mp3',</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredquality': '192'}]</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_video_opts = {</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_audio_opts).download([video_url])</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_video_opts).download([video_url])</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="st">## Generate the transcript</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="st">import whisperx</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="st">device = "cuda" </span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="st">audio_file = "whisper_messi_corto.mp3"</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="st"># transcribe with original whisper</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="st">model = whisperx.load_model("large-v2", device)</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="st">result = model.transcribe(audio_file)</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="st">print(result["segments"]) # before alignment</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="st"># load alignment model and metadata</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="st">model_a, metadata = whisperx.load_align_model(language_code=result["language"], device=device)</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="st"># align whisper output</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="st">result_aligned = whisperx.align(result["segments"], model_a, metadata, audio_file, device)</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="st">## Embed the transcript in the video as subtitles</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="st">import pandas as pd</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="st">import cv2</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import VideoFileClip</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="st">import moviepy.editor as mp</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import *</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.video.tools.subtitles import SubtitlesClip</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="st">dict1 = {'start':[], 'end':[], 'text':[]}</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="st">for i in result_aligned['segments']:</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['start'].append(int(i['start']))</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['end'].append(int(i['end']))</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['text'].append(i['text'])</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="st">df = pd.DataFrame.from_dict(dict1)</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="st">df.to_csv(f'whisper_messi_corto_subs.csv')</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="st">videocap = cv2.VideoCapture("whisper_messi_corto.mp4")</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="st">success, image = videocap.read()</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a><span class="st">height = image.shape[0]</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="st">width =image.shape[1]</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="st">generator = lambda txt: TextClip(txt, font='P052-Bold', fontsize=width/50, stroke_width=.7, color='white', stroke_color = 'black', size = (width, height*.25), method='caption')</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="st">subs = tuple(zip(tuple(zip(df['start'].values, df['end'].values)), df['text'].values))</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a><span class="st">subtitles = SubtitlesClip(subs, generator)</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="st">video = VideoFileClip('whisper_messi_corto.mp4')</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="st">final = CompositeVideoClip([video, subtitles.set_pos(('center','bottom'))])</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a><span class="st">final.write_videofile('whisper_messi_corto_con_subs.mp4', fps=video.fps, remove_temp=True, codec="libx264", audio_codec="aac")</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a><span class="st">Here the final product, the video with the subtitles:</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;video width="640" height="480" controls&gt;</span></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;source src="whisper_messi_corto_con_subs.mp4" type="video/mp4"&gt;</span></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/video&gt;</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>posteo_fusionado_ejemplo <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">title: Using Whisper to Transcribe Messi</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">subtitle: Transcribir a Messi con Whisper</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">author: Martin Olmos</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">date: '2023-02-03'</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">slug: []</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">categories:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">  - NLP</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">  - IA</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">  - ML</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">tags:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">  - Whisper</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">  - Messi</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="english"}</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">[Whisper]('https://openai.com/blog/whisper/') is an open source model for speech recognition developed by [OpenAI](https://openai.com).</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="st">We will try to use it to add subtitles to a recent interview.</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="st">Here is the original interview:</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="spanish"}</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="st">[Whisper]('https://openai.com/blog/whisper/') es un modelo de código abierto para reconocimiento del habla desarrollado por [OpenAI](https://openai.com).</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">Intentaremos utilizarlo para agregar subtítulos a una entrevista reciente.</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="st">Aquí la entrevista original:</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/RYXcR3YejwY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen&gt;&lt;/iframe&gt;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="english"}</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="st">## Download audio and video from Youtube</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="spanish"}</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="st">## Descargo el audio y el video de Youtube</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="st">import youtube_dl as ydl</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="st">video_url = 'https://www.youtube.com/watch?v=RYXcR3YejwY'</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_audio_opts = {</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="st">    'format': 'bestaudio/best',</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="st">    'postprocessors': [{</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="st">        'key': 'FFmpegExtractAudio',</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredcodec': 'mp3',</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="st">        'preferredquality': '192'}]</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="st">ydl_video_opts = {</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="st">    'outtmpl': 'whisper_messi_corto.</span><span class="sc">%(ext)s</span><span class="st">',</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_audio_opts).download([video_url])</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="st">ydl.YoutubeDL(ydl_video_opts).download([video_url])</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="english"}</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="st">## Generate the transcript</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="spanish"}</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="st">## Genero la transcripción</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="st">import whisperx</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="st">device = "cuda" </span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="st">audio_file = "whisper_messi_corto.mp3"</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="st"># transcribe with original whisper</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="st">model = whisperx.load_model("large-v2", device)</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="st">result = model.transcribe(audio_file)</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="st">print(result["segments"]) # before alignment</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="st"># load alignment model and metadata</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="st">model_a, metadata = whisperx.load_align_model(language_code=result["language"], device=device)</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="st"># align whisper output</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="st">result_aligned = whisperx.align(result["segments"], model_a, metadata, audio_file, device)</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="english"}</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="st">## Embed the transcript in the video as subtitles</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="spanish"}</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="st">## Incrusto la transcripción en el video como subtítulos</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="st">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="st">import pandas as pd</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="st">import cv2</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import VideoFileClip</span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="st">import moviepy.editor as mp</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.editor import *</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="st">from moviepy.video.tools.subtitles import SubtitlesClip</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a><span class="st">dict1 = {'start':[], 'end':[], 'text':[]}</span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="st">for i in result_aligned['segments']:</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['start'].append(int(i['start']))</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['end'].append(int(i['end']))</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a><span class="st">  dict1['text'].append(i['text'])</span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a><span class="st">df = pd.DataFrame.from_dict(dict1)</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a><span class="st">df.to_csv(f'whisper_messi_corto_subs.csv')</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="st">videocap = cv2.VideoCapture("whisper_messi_corto.mp4")</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a><span class="st">success, image = videocap.read()</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a><span class="st">height = image.shape[0]</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a><span class="st">width =image.shape[1]</span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a><span class="st">generator = lambda txt: TextClip(txt, font='P052-Bold', fontsize=width/50, stroke_width=.7, color='white', stroke_color = 'black', size = (width, height*.25), method='caption')</span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="st">subs = tuple(zip(tuple(zip(df['start'].values, df['end'].values)), df['text'].values))</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="st">subtitles = SubtitlesClip(subs, generator)</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="st">video = VideoFileClip('whisper_messi_corto.mp4')</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a><span class="st">final = CompositeVideoClip([video, subtitles.set_pos(('center','bottom'))])</span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="st">final.write_videofile('whisper_messi_corto_con_subs.mp4', fps=video.fps, remove_temp=True, codec="libx264", audio_codec="aac")</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="english"}</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="st">Here is the final product, the video with the subtitles:</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a><span class="st">::: {.content-visible when-profile="spanish"}</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="st">Aquí el producto final, el video con los subtítulos:</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a><span class="st">:::</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;center&gt;</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;video width="640" height="480" controls&gt;</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;source src="whisper_messi_corto_con_subs.mp4" type="video/mp4"&gt;</span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/video&gt;</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/center&gt;</span></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'posts/30-day-map-challenge-day-1-and-2/ejemplo_espanol.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    posteo_espanol_ejemplo <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'posts/30-day-map-challenge-day-1-and-2/ejemplo_ingles.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    posteo_ingles_ejemplo <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'posts/30-day-map-challenge-day-1-and-2/ejemplo_fusion.txt'</span>, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    posteo_fusionado_ejemplo <span class="op">=</span> <span class="bu">file</span>.read()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(posteo_fusionado_ejemplo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---
title: Using Whisper to Transcribe Messi
subtitle: Transcribir a Messi con Whisper
author: Martin Olmos
date: '2023-02-03'
slug: []
categories:
  - NLP
  - IA
  - ML
tags:
  - Whisper
  - Messi
---

::: {.content-visible when-profile="english"}
[Whisper]('https://openai.com/blog/whisper/') is an open source model for speech recognition developed by [OpenAI](https://openai.com).

We will try to use it to add subtitles to a recent interview.

Here is the original interview:

:::

::: {.content-visible when-profile="spanish"}
[Whisper]('https://openai.com/blog/whisper/') es un modelo de código abierto para reconocimiento del habla desarrollado por [OpenAI](https://openai.com).

Intentaremos utilizarlo para agregar subtítulos a una entrevista reciente.

Aquí la entrevista original:

:::

&lt;center&gt;
&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/RYXcR3YejwY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen&gt;&lt;/iframe&gt;
&lt;/center&gt;

::: {.content-visible when-profile="english"}
## Download audio and video from Youtube

:::

::: {.content-visible when-profile="spanish"}
## Descargo el audio y el video de Youtube

:::

```{python, eval=FALSE, echo=TRUE}

import youtube_dl as ydl

video_url = 'https://www.youtube.com/watch?v=RYXcR3YejwY'

ydl_audio_opts = {
    'outtmpl': 'whisper_messi_corto.%(ext)s',
    'format': 'bestaudio/best',
    'postprocessors': [{
        'key': 'FFmpegExtractAudio',
        'preferredcodec': 'mp3',
        'preferredquality': '192'}]
}
ydl_video_opts = {
    'outtmpl': 'whisper_messi_corto.%(ext)s',
}

ydl.YoutubeDL(ydl_audio_opts).download([video_url])
ydl.YoutubeDL(ydl_video_opts).download([video_url])

```

:::

::: {.content-visible when-profile="english"}
## Generate the transcript

:::

::: {.content-visible when-profile="spanish"}
## Genero la transcripción

:::

```{python, eval=FALSE, echo=TRUE}
import whisperx

device = "cuda" 
audio_file = "whisper_messi_corto.mp3"

# transcribe with original whisper
model = whisperx.load_model("large-v2", device)
result = model.transcribe(audio_file)

print(result["segments"]) # before alignment

# load alignment model and metadata
model_a, metadata = whisperx.load_align_model(language_code=result["language"], device=device)

# align whisper output
result_aligned = whisperx.align(result["segments"], model_a, metadata, audio_file, device)
```

</code></pre>
</div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/spanish/post/2021-11-06-30-days-map-challenge-dia-1-y-2/index.es.Rmd'</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    posteo_espanol <span class="op">=</span> f.readlines()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/english/post/2021-11-06-30-days-map-challenge-day-1-and-2/index.en.Rmd'</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    posteo_ingles <span class="op">=</span> f.readlines()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>posteo_espanol <span class="op">=</span> <span class="st">""</span>.join(posteo_espanol)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>posteo_ingles <span class="op">=</span> <span class="st">""</span>.join(posteo_ingles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>posteo_espanol <span class="op">=</span> re.sub(<span class="vs">r'\`\`\`\{r include=FALSE, message=FALSE}\\nknitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)\\n\`\`\`'</span>, <span class="st">''</span>, posteo_espanol)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>posteo_ingles <span class="op">=</span> re.sub(<span class="vs">r'```{r include=FALSE, message=FALSE}\nknitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)\n```'</span>, <span class="st">''</span>, posteo_ingles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> <span class="vs">r"```{r\s+include=FALSE,\s+message=FALSE}\nknitr::opts_chunk\$set\(echo\s+=\s+TRUE,\s+message\s+=\s+FALSE,\s+warning\s+=\s+FALSE\)\n```"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>posteo_espanol <span class="op">=</span> re.sub(pattern, <span class="st">''</span>, posteo_espanol, flags<span class="op">=</span>re.DOTALL)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>posteo_ingles <span class="op">=</span> re.sub(pattern, <span class="st">''</span>, posteo_ingles, flags<span class="op">=</span>re.DOTALL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="prompt" class="level3">
<h3 class="anchored" data-anchor-id="prompt">Prompt</h3>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ss">Te voy a pasar un posteo de un blog en español y en inglés y necesito que los fusiones de un modo particular. </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ss">El encabezado o YAML está demarcado por `---` al principio y al final. La idea es conservar un sólo encabezado, con el título en inglés y el subtítulo en español. </span><span class="ch">\</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ss">Los textos entre cada bloque de código deben enmarcarse con `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span><span class="ss">` par el texto en español y `:::` y con `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span><span class="ss">` y `:::` para el texto en inglés.  \ </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ss">Cada bloque de código debe aparecer una sóla vez luego del texto en español e inglés. </span><span class="ch">\</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ss">La estructura esperada es la siguiente: </span><span class="ch">\</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ss">---</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ss">title: Title in english</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ss">subtitle: Título en español</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ss">author: Martin Olmos</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ss">...</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="ss">First text block in english. Should contain all text until the first code block.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="ss">Primer bloque de texto en español. Debería contener todo el texto hasta el primer bloque de código.</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span><span class="sc">{</span>python<span class="sc">,</span> <span class="bu">eval</span><span class="op">=</span>FALSE<span class="sc">,</span> echo<span class="op">=</span>TRUE<span class="sc">}</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="ss">First code block</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="ss">Second text block in english. Should contain all text until the second code block.</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="ss">Segundo bloque de texto en español. Debería contener todo el texto hasta el segundo bloque de código.</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span><span class="sc">{</span>python<span class="sc">,</span> <span class="bu">eval</span><span class="op">=</span>FALSE<span class="sc">,</span> echo<span class="op">=</span>TRUE<span class="sc">}</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="ss">Second code block</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="ss">Ahora fusiona los siguientes posteos: </span><span class="ch">\</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en español: </span><span class="ch">\</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_espanol<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en inglés: </span><span class="ch">\</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_ingles<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo fusionado esperado: </span><span class="ch">\</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Te voy a pasar un posteo de un blog en español y en inglés y necesito que los fusiones de un modo particular. 

El encabezado o YAML está demarcado por `---` al principio y al final. La idea es conservar un sólo encabezado, con el título en inglés y el subtítulo en español. Los textos entre cada bloque de código deben enmarcarse con `::: {.content-visible when-profile="spanish"}` par el texto en español y `:::` y con `::: {.content-visible when-profile="english"}` y `:::` para el texto en inglés.  \ 
Cada bloque de código debe aparecer una sóla vez luego del texto en español e inglés. 
La estructura esperada es la siguiente: 
---
title: Title in english
subtitle: Título en español
author: Martin Olmos
...

::: {.content-visible when-profile="english"}

First text block in english. Should contain all text until the first code block.

:::

::: {.content-visible when-profile="spanish"}

Primer bloque de texto en español. Debería contener todo el texto hasta el primer bloque de código.

:::

```{python, eval=FALSE, echo=TRUE}

First code block

```

::: {.content-visible when-profile="english"}

Second text block in english. Should contain all text until the second code block.

:::

::: {.content-visible when-profile="spanish"}

Segundo bloque de texto en español. Debería contener todo el texto hasta el segundo bloque de código.

:::

```{python, eval=FALSE, echo=TRUE}

Second code block

```

Ahora fusiona los siguientes posteos: 
Posteo en español: ---
title: 30 Days Map Challenge Día 1 y 2
author: Martin Olmos
date: '2021-11-06'
slug: []
categories: []
tags:
  - 30daymapchallenge
---

*Nota: para aquellos interesados en el código con el que se generó cada visualización pueden verlo presionando el botón "Show/Hide All Code" arriba a la derecha de la página o el botón "Code" arriba y a la derecha de cada visualización.*

El [#30daymapchallenge][1] es un desafío de mapeo/cartografía/visualización de datos organizado por la comunidad de gente que se dedica a estos temas. La idea es publicar mapas en base a una consigna diaria durante 30 días usando el hashtag [#30daymapchallenge][1].

Estos son los temas diarios para los desafíos de este año:

![](30dmpc_2021.png)  

Yo en particular me voy a centrar (los días que pueda publicar) en datos relacionados con TICs, siempre que sea posible.

Empecemos con los desafíos de los días 1 (puntos) y 2 (líneas).

## Día 1 - Puntos

Nodos de conexión a la [Red Federal de Fibra Óptica (REFEFO)][2] de [ARSAT][3].

La REFEFO es una [red troncal de fibra óptica][4]. En los puntos o nodos de conexión los proveedores de internet o ISPs se conectan para llevar internet a los hogares.

```{r, eval=FALSE}
library(tidyverse)
library(sf)
sf_use_s2(FALSE)
library(httr)

provincias_ign &lt;- read_sf("https://wms.ign.gob.ar/geoserver/ows?service=wfs&amp;version=1.1.0&amp;request=GetFeature&amp;typeNames=ign:provincia&amp;outputFormat=application/json")

if(sum(!st_is_valid(provincias_ign)) &gt; 0) {
  provincias_ign &lt;- st_make_valid(provincias_ign)
}

provincias_ign &lt;- st_crop(x = provincias_ign,
                          y = st_bbox(obj = c(xmin=-76.36532,
                                              ymin=-56.75009,
                                              xmax=-51.20850,
                                              ymax=-20.91625)))

nodos_refefo &lt;- read.csv2("https://datos.arsat.com.ar/dataset/8f0b4da0-a40d-4b2b-8fe0-dac06d64152a/resource/15713af0-f384-44c5-8397-c8050162312d/download/puntos-conexion-red-federal-de-fibra-optica-2021-12-01_v1.csv", fileEncoding = "LATIN1")

nodos_refefo &lt;- nodos_refefo %&gt;%
  na.omit() %&gt;%
  st_as_sf(crs = 4326, coords=c("Longitud", "Latitud"), remove=FALSE)

nodos_refefo &lt;- st_crop(x = nodos_refefo,
                        y = st_bbox(obj = c(xmin=-76.36532,
                                            ymin=-56.75009,
                                            xmax=-51.20850,
                                            ymax=-20.91625)))

provincias_ign %&gt;% 
  ggplot() + 
  geom_sf() +
  geom_sf(data = nodos_refefo, color = "#2ca25f", size = 0.5) +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.datos.gob.ar")

```
&lt;center&gt;
![](refefo_nodos_map.png)
&lt;/center&gt;

## Día 2 - Líneas

Traza de la REFEFO. La fibra óptica de la REFEFO en general va enterrada al lado de rutas nacionales y provinciales, conectando distintas localidades pequeñas y medianas, donde no llegan otros proveedores o hay uno sólo y por lo tanto no se dan condiciones de competencia.

```{r, eval=FALSE}
idecom_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"
refefo_query &lt;- list(service="wfs",
                     version="1.3.0",
                     request="GetFeature",
                     typeNames="publico:FO118-TZFO-REDFIBRAOPTICA-5-2",
                     CQL_FILTER="OBSERV='ARSAT - ReFeFO'",
                     outputFormat="application/json")

idecom_url &lt;- modify_url(url = idecom_base_url, 
                         query = refefo_query)

traza_refefo_idecom &lt;- read_sf(idecom_url)

provincias_ign %&gt;% 
  ggplot() +
  geom_sf() +
  geom_sf(data = traza_refefo_idecom, colour="#2b8cbe") +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.idecom.gob.ar")

```

&lt;center&gt;
![](refefo_traza_map.png)
&lt;/center&gt;
[1]:https://github.com/tjukanovt/30DayMapChallenge
[2]:https://www.argentina.gob.ar/jefatura/innovacion-publica/ssetic/conectar/refefo/que-es-la-red-federal-de-fibra-optica
[3]:https://www.arsat.com.ar
[4]:https://es.wikipedia.org/wiki/Backbone 
Posteo en inglés: ---
title: 30 Days Map Challenge Day 1 and 2
author: Martin Olmos
date: '2021-11-06'
slug: []
categories: []
tags:
  - 30daymapchallenge
---

*Note: for those interested in the code for each visualization you can see it by pressing the "Show All Code" button at the top right of the page or by pressing the "Code" button above and to the right of each visualization.*


The [#30daymapchallenge][1] is a mapping/cartography/data visualization challenge powered by the data science community. The idea is to publish maps based on a daily challenge for 30 days using the hashtag [#30daymapchallenge][1].

Here are the daily themes for this year's challenges:
![](30dmpc_2021.png)  

In particular, I am going to focus (whenever I can) on data related to ICTs.

Let's start with the challenges of days 1 (points) and 2 (lines).

## Day 1 - Points

Connection nodes to the [Federal Fiber Optic Network (REFEFO)][2] of [ARSAT][3].

The REFEFO is a [fiber optic trunk network][4]. Internet providers or ISPs connect to the connection points or nodes to bring internet services to final users.

```{r, eval=FALSE}
library(tidyverse)
library(sf)
sf_use_s2(FALSE)
library(httr)

provincias_ign &lt;- read_sf("https://wms.ign.gob.ar/geoserver/ows?service=wfs&amp;version=1.1.0&amp;request=GetFeature&amp;typeNames=ign:provincia&amp;outputFormat=application/json")

if(sum(!st_is_valid(provincias_ign)) &gt; 0) {
  provincias_ign &lt;- st_make_valid(provincias_ign)
}

provincias_ign &lt;- st_crop(x = provincias_ign,
                          y = st_bbox(obj = c(xmin=-76.36532,
                                              ymin=-56.75009,
                                              xmax=-51.20850,
                                              ymax=-20.91625)))

nodos_refefo &lt;- read.csv2("https://datos.arsat.com.ar/dataset/8f0b4da0-a40d-4b2b-8fe0-dac06d64152a/resource/15713af0-f384-44c5-8397-c8050162312d/download/puntos-conexion-red-federal-de-fibra-optica-2021-12-01_v1.csv", fileEncoding = "LATIN1")

nodos_refefo &lt;- nodos_refefo %&gt;%
  na.omit() %&gt;%
  st_as_sf(crs = 4326, coords=c("Longitud", "Latitud"), remove=FALSE)

nodos_refefo &lt;- st_crop(x = nodos_refefo,
                        y = st_bbox(obj = c(xmin=-76.36532,
                                            ymin=-56.75009,
                                            xmax=-51.20850,
                                            ymax=-20.91625)))

provincias_ign %&gt;% 
  ggplot() + 
  geom_sf() +
  geom_sf(data = nodos_refefo, color = "#2ca25f", size = 0.5) +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.datos.gob.ar")

```
&lt;center&gt;
![](refefo_nodos_map.png)
&lt;/center&gt;

## Day 2 - Lines

Lay out of the REFEFO. The optical fiber of the REFEFO is generally buried next to national and provincial routes, connecting different small and medium-sized towns, where there are no other providers or there is only one and therefore there is no competition.

```{r, eval=FALSE}
idecom_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"
refefo_query &lt;- list(service="wfs",
                     version="1.3.0",
                     request="GetFeature",
                     typeNames="publico:FO118-TZFO-REDFIBRAOPTICA-5-2",
                     CQL_FILTER="OBSERV='ARSAT - ReFeFO'",
                     outputFormat="application/json")

idecom_url &lt;- modify_url(url = idecom_base_url, 
                         query = refefo_query)

traza_refefo_idecom &lt;- read_sf(idecom_url)

provincias_ign %&gt;% 
  ggplot() +
  geom_sf() +
  geom_sf(data = traza_refefo_idecom, colour="#2b8cbe") +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.idecom.gob.ar")

```

&lt;center&gt;
![](refefo_traza_map.png)
&lt;/center&gt;
[1]:https://github.com/tjukanovt/30DayMapChallenge
[2]:https://www.argentina.gob.ar/jefatura/innovacion-publica/ssetic/conectar/refefo/que-es-la-red-federal-de-fibra-optica
[3]:https://www.arsat.com.ar
[4]:https://es.wikipedia.org/wiki/Backbone 
Posteo fusionado esperado: 
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># response = get_completion(prompt.format(</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_espanol_ejemplo=posteo_espanol_ejemplo,</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_ingles_ejemplo=posteo_ingles_ejemplo,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_fusionado_ejemplo=posteo_fusionado_ejemplo,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_espanol=posteo_espanol,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_ingles=posteo_ingles,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ))</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> get_completion(prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---
title: 30 Days Map Challenge Day 1 and 2
subtitle: Título en español
author: Martin Olmos
date: '2021-11-06'
slug: []
categories: []
tags:
  - 30daymapchallenge
---

::: {.content-visible when-profile="english"}

*Note: for those interested in the code for each visualization you can see it by pressing the "Show All Code" button at the top right of the page or by pressing the "Code" button above and to the right of each visualization.*


The [#30daymapchallenge][1] is a mapping/cartography/data visualization challenge powered by the data science community. The idea is to publish maps based on a daily challenge for 30 days using the hashtag [#30daymapchallenge][1].

Here are the daily themes for this year's challenges:
![](30dmpc_2021.png)  

In particular, I am going to focus (whenever I can) on data related to ICTs.

Let's start with the challenges of days 1 (points) and 2 (lines).

:::

::: {.content-visible when-profile="spanish"}

*Nota: para aquellos interesados en el código con el que se generó cada visualización pueden verlo presionando el botón "Show/Hide All Code" arriba a la derecha de la página o el botón "Code" arriba y a la derecha de cada visualización.*

El [#30daymapchallenge][1] es un desafío de mapeo/cartografía/visualización de datos organizado por la comunidad de gente que se dedica a estos temas. La idea es publicar mapas en base a una consigna diaria durante 30 días usando el hashtag [#30daymapchallenge][1].

Estos son los temas diarios para los desafíos de este año:

![](30dmpc_2021.png)  

Yo en particular me voy a centrar (los días que pueda publicar) en datos relacionados con TICs, siempre que sea posible.

Empecemos con los desafíos de los días 1 (puntos) y 2 (líneas).

:::

```{r, eval=FALSE}
library(tidyverse)
library(sf)
sf_use_s2(FALSE)
library(httr)

provincias_ign &lt;- read_sf("https://wms.ign.gob.ar/geoserver/ows?service=wfs&amp;version=1.1.0&amp;request=GetFeature&amp;typeNames=ign:provincia&amp;outputFormat=application/json")

if(sum(!st_is_valid(provincias_ign)) &gt; 0) {
  provincias_ign &lt;- st_make_valid(provincias_ign)
}

provincias_ign &lt;- st_crop(x = provincias_ign,
                          y = st_bbox(obj = c(xmin=-76.36532,
                                              ymin=-56.75009,
                                              xmax=-51.20850,
                                              ymax=-20.91625)))

nodos_refefo &lt;- read.csv2("https://datos.arsat.com.ar/dataset/8f0b4da0-a40d-4b2b-8fe0-dac06d64152a/resource/15713af0-f384-44c5-8397-c8050162312d/download/puntos-conexion-red-federal-de-fibra-optica-2021-12-01_v1.csv", fileEncoding = "LATIN1")

nodos_refefo &lt;- nodos_refefo %&gt;%
  na.omit() %&gt;%
  st_as_sf(crs = 4326, coords=c("Longitud", "Latitud"), remove=FALSE)

nodos_refefo &lt;- st_crop(x = nodos_refefo,
                        y = st_bbox(obj = c(xmin=-76.36532,
                                            ymin=-56.75009,
                                            xmax=-51.20850,
                                            ymax=-20.91625)))

provincias_ign %&gt;% 
  ggplot() + 
  geom_sf() +
  geom_sf(data = nodos_refefo, color = "#2ca25f", size = 0.5) +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.datos.gob.ar")

```
&lt;center&gt;
![](refefo_nodos_map.png)
&lt;/center&gt;

::: {.content-visible when-profile="english"}

## Day 2 - Lines

Lay out of the REFEFO. The optical fiber of the REFEFO is generally buried next to national and provincial routes, connecting different small and medium-sized towns, where there are no other providers or there is only one and therefore there is no competition.

```{r, eval=FALSE}
idecom_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"
refefo_query &lt;- list(service="wfs",
                     version="1.3.0",
                     request="GetFeature",
                     typeNames="publico:FO118-TZFO-REDFIBRAOPTICA-5-2",
                     CQL_FILTER="OBSERV='ARSAT - ReFeFO'",
                     outputFormat="application/json")

idecom_url &lt;- modify_url(url = idecom_base_url, 
                         query = refefo_query)

traza_refefo_idecom &lt;- read_sf(idecom_url)

provincias_ign %&gt;% 
  ggplot() +
  geom_sf() +
  geom_sf(data = traza_refefo_idecom, colour="#2b8cbe") +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.idecom.gob.ar")

```

&lt;center&gt;
![](refefo_traza_map.png)
&lt;/center&gt;

:::

::: {.content-visible when-profile="spanish"}

## Día 2 - Líneas

Traza de la REFEFO. La fibra óptica de la REFEFO en general va enterrada al lado de rutas nacionales y provinciales, conectando distintas localidades pequeñas y medianas, donde no llegan otros proveedores o hay uno sólo y por lo tanto no se dan condiciones de competencia.

```{r, eval=FALSE}
idecom_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"
refefo_query &lt;- list(service="wfs",
                     version="1.3.0",
                     request="GetFeature",
                     typeNames="publico:FO118-TZFO-REDFIBRAOPTICA-5-2",
                     CQL_FILTER="OBSERV='ARSAT - ReFeFO'",
                     outputFormat="application/json")

idecom_url &lt;- modify_url(url = idecom_base_url, 
                         query = refefo_query)

traza_refefo_idecom &lt;- read_sf(idecom_url)

provincias_ign %&gt;% 
  ggplot() +
  geom_sf() +
  geom_sf(data = traza_refefo_idecom, colour="#2b8cbe") +
  coord_sf(datum = NA) +
  theme_bw() +
  labs(caption = "Fuente: www.idecom.gob.ar")

```

&lt;center&gt;
![](refefo_traza_map.png)
&lt;/center&gt;

:::

[1]:https://github.com/tjukanovt/30DayMapChallenge
[2]:https://www.argentina.gob.ar/jefatura/innovacion-publica/ssetic/conectar/refefo/que-es-la-red-federal-de-fibra-optica
[3]:https://www.arsat.com.ar
[4]:https://es.wikipedia.org/wiki/Backbone</code></pre>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">'posts/30-day-map-challenge-day-3-and-4/'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>os.mkdir(folder)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(folder <span class="op">+</span> <span class="st">'index.qmd'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    f.write(response.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="day-map-challenge-day-3-and-4" class="level2">
<h2 class="anchored" data-anchor-id="day-map-challenge-day-3-and-4">30 day map challenge day 3 and 4</h2>
<div class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/spanish/post/2021-11-09-30-day-map-challenge-dia-3-y-4/index.es.Rmd'</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    posteo_espanol <span class="op">=</span> f.read()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with open('/Users/martinolmos/Documents/datos_tic/content/english/post/2021-11-09-30-day-map-challenge-day-3-and-4/index.en.Rmd', 'r') as f:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     posteo_ingles = f.readlines()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>posteo_espanol_ingles_ejemplo <span class="op">=</span> posteo_fusionado_ejemplo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fusionar_posteo(posteo_espanol):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ss">Te voy a pasar un posteo de un blog en español y necesito que le agregues la traducción al inglés. </span><span class="ch">\</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ss">El posteo contiene texto en español y bloques de código. </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ss">Lo que necesito es que el texto en español lo enmarques entre `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span><span class="ss">` y ::: </span><span class="ch">\</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ss">y a continuación agregues el texto traducido al inglés enmarcado entre `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span><span class="ss">` y `:::` .  </span><span class="ch">\</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ss">Los bloques de código deben aparecer una sóla vez luego del texto en español e inglés. </span><span class="ch">\</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ss">El encabezado o YAML está demarcado por `---` al principio y al final. La idea es tener un encabezado con el título en inglés y el subtítulo en español. </span><span class="ch">\</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ss">Te voy a mostrar un ejemplo:</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en español: </span><span class="ch">\</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_espanol_ejemplo<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="ss">Resultado esperado en español e inglés: </span><span class="ch">\</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_espanol_ingles_ejemplo<span class="sc">}</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="ss">Ahora transforma el siguiente posteo: </span><span class="ch">\</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en español: </span><span class="ch">\</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_espanol<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="ss">Resultado esperado en español e inglés: </span><span class="ch">\</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> get_completion(prompt)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>posteo_espanol_ingles <span class="op">=</span> fusionar_posteo(posteo_espanol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(posteo_espanol_ingles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---
title: 30 Day Map Challenge Day 3 and 4
subtitle: Día 3 y 4 del Desafío de Mapas de 30 Días
author: Martin Olmos
date: '2021-11-09'
slug: []
categories: []
tags:
  - 30daymapchallenge
---

::: {.content-visible when-profile="english"}
```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
*Note: for those interested in the code used to generate each visualization, you can see it by clicking the "Show/Hide All Code" button at the top right of the page or the "Code" button above and to the right of each visualization.*

## Day 3 - Polygons

Mobile network cells can be modeled using [Voronoi Diagrams][3]. Typically, this is done for mobility analysis with cellular signaling data, as shown in [this paper][5].

:::

::: {.content-visible when-profile="spanish"}
```{r, eval=FALSE}
library(tidyverse)
library(sf)
library(httr)
library(ggvoronoi)
library(ggmap)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:departamento",
                            cql_filter="in1='02007'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)

comuna1_sf &lt;- read_sf(ign_geoserver_url)

comuna1_centroid &lt;- st_centroid(comuna1_sf)
comuna1_bbox &lt;- st_bbox(comuna1_sf)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(comuna1_bbox[c(2,1,4,3)], collapse = ","), ")", " AND Banda='7'"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_comuna1 &lt;- read_sf(idecom_geoserver_url)

radiobases_4g_comuna1 &lt;- radiobases_4g_comuna1 %&gt;% 
  as_Spatial() %&gt;% 
  sp::remove.duplicates() %&gt;% 
  st_as_sf() %&gt;% 
  na.omit()

register_google(Sys.getenv("GOOGLE_MAPS_API_KEY"))
comuna1_map &lt;- get_googlemap(center = c(lon=-58.37869433449463, 
                                        lat=-34.606838945727), 
                             zoom = 15)

ggmap(comuna1_map, 
      base_layer = ggplot(data = na.omit(st_drop_geometry(radiobases_4g_comuna1)), 
                          aes(Longitud, Latitud))) +
  geom_path(stat = "voronoi", alpha = 0.6, size = 0.4) +
  geom_point(color = "blue", size = 0.7) +
  theme_minimal() +
  theme(axis.text = element_blank(),
        axis.title = element_blank())

```

&lt;center&gt;
![](radiobases_4g_comuna1_map.png){width=75%}
&lt;/center&gt;

:::

::: {.content-visible when-profile="english"}
## Day 4 - Hexagons

Hexagons can also be used to plot 4G radio bases, using color intensity to show their density.

:::

::: {.content-visible when-profile="spanish"}
```{r, eval=FALSE}
library(hexbin)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:provincia",
                            CQL_FILTER="in1='02'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)
caba &lt;- read_sf(ign_geoserver_url)

caba_bb &lt;- st_bbox(caba)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(caba_bb[c(2,1,4,3)], collapse = ","), ")"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_caba &lt;- read_sf(idecom_geoserver_url)

if(st_crs(caba)!=st_crs(radiobases_4g_caba)) {
  radiobases_4g_caba &lt;- st_transform(radiobases_4g_caba, crs = st_crs(caba))
}
radiobases_4g_caba &lt;- st_join(radiobases_4g_caba, caba, left=FALSE)

caba %&gt;% 
  ggplot() +
  geom_sf() +
  geom_hex(data = radiobases_4g_caba, aes(Longitud, Latitud)) +
  theme_bw() +
  coord_sf(datum = NA) +
  scale_fill_viridis_c(direction = -1, name = "Radiobases 4G") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())

```

&lt;center&gt;
![](radiobases_4g_caba_map.png)
&lt;/center&gt;

:::

[3]:https://en.wikipedia.org/wiki/Voronoi_diagram
[5]:https://www.researchgate.net/publication/260297863_Mobile_Phone_Location_Area_Based_Traffic_Flow_Estimation_in_Urban_Road_Traffic</code></pre>
</div>
</div>
<div class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">'posts/30-day-map-challenge-day-3-and-4/'</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># os.mkdir(folder)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(folder <span class="op">+</span> <span class="st">'index.qmd'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    f.write(posteo_espanol_ingles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(posteo_fusionado.choices[<span class="dv">0</span>].message.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---
title: 30 Day Map Challenge Day 3 and 4
subtitle: Día 3 y 4 del Desafío de Mapas de 30 Días
author: Martin Olmos
date: '2021-11-09'
slug: []
categories: []
tags:
  - 30daymapchallenge
---

::: {.content-visible when-profile="english"}
```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

*Note: for thoses interested in the code for each visualization you can see it by pressing the "Show All Code" button at the top right of the page or by pressing the "Code" button above and to the right of each visualization.*

## Day 3 - Polygons

The cells of mobile networks can be modeled using [Voronoi diagrams][3]. Typically this is done for mobility analysis with cell phone signaling data, as shown in [this paper][5].

```{r, eval=FALSE}
library(tidyverse)
library(sf)
library(httr)
library(ggvoronoi)
library(ggmap)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:departamento",
                            cql_filter="in1='02007'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)

comuna1_sf &lt;- read_sf(ign_geoserver_url)

comuna1_centroid &lt;- st_centroid(comuna1_sf)
comuna1_bbox &lt;- st_bbox(comuna1_sf)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(comuna1_bbox[c(2,1,4,3)], collapse = ","), ")", " AND Banda='7'"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_comuna1 &lt;- read_sf(idecom_geoserver_url)

radiobases_4g_comuna1 &lt;- radiobases_4g_comuna1 %&gt;% 
  as_Spatial() %&gt;% 
  sp::remove.duplicates() %&gt;% 
  st_as_sf() %&gt;% 
  na.omit()

register_google(Sys.getenv("GOOGLE_MAPS_API_KEY"))
comuna1_map &lt;- get_googlemap(center = c(lon=-58.37869433449463, 
                                        lat=-34.606838945727), 
                             zoom = 15)

ggmap(comuna1_map, 
      base_layer = ggplot(data = na.omit(st_drop_geometry(radiobases_4g_comuna1)), 
                          aes(Longitud, Latitud))) +
  geom_path(stat = "voronoi", alpha = 0.6, size = 0.4) +
  geom_point(color = "blue", size = 0.7) +
  theme_minimal() +
  theme(axis.text = element_blank(),
        axis.title = element_blank())

```

&lt;center&gt;
![](radiobases_4g_comuna1_map.png){width=75%}
&lt;/center&gt;

## Day 4 - Hexagons

Hexagons can also be used to visualize 4G base stations, using the color intensity to show density.

```{r, eval=FALSE}
library(hexbin)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:provincia",
                            CQL_FILTER="in1='02'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)
caba &lt;- read_sf(ign_geoserver_url)

caba_bb &lt;- st_bbox(caba)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(caba_bb[c(2,1,4,3)], collapse = ","), ")"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_caba &lt;- read_sf(idecom_geoserver_url)

if(st_crs(caba)!=st_crs(radiobases_4g_caba)) {
  radiobases_4g_caba &lt;- st_transform(radiobases_4g_caba, crs = st_crs(caba))
}
radiobases_4g_caba &lt;- st_join(radiobases_4g_caba, caba, left=FALSE)

caba %&gt;% 
  ggplot() +
  geom_sf() +
  geom_hex(data = radiobases_4g_caba, aes(Longitud, Latitud)) +
  theme_bw() +
  coord_sf(datum = NA) +
  scale_fill_viridis_c(direction = -1, name = "Radiobases 4G") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())

```

&lt;center&gt;
![](radiobases_4g_caba_map.png)
&lt;/center&gt;

[3]:https://es.wikipedia.org/wiki/Pol%C3%ADgonos_de_Thiessen
[5]:https://www.researchgate.net/publication/260297863_Mobile_Phone_Location_Area_Based_Traffic_Flow_Estimation_in_Urban_Road_Traffic
:::

::: {.content-visible when-profile="spanish"}
```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

*Nota: para aquellos interesados en el código con el que se generó cada visualización pueden verlo presionando el botón "Show/Hide All Code" arriba a la derecha de la página o el botón "Code" arriba y a la derecha de cada visualización.*

## Día 3 - Polígonos

Las celdas de las redes móviles se pueden modelar mediante [Diagramas de Voronoi][3]. Típicamente esto se hace para análisis de movilidad con datos de señalización de los teléfonos celulares, como se muestra en [este paper][5]. 

```{r, eval=FALSE}
library(tidyverse)
library(sf)
library(httr)
library(ggvoronoi)
library(ggmap)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:departamento",
                            cql_filter="in1='02007'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)

comuna1_sf &lt;- read_sf(ign_geoserver_url)

comuna1_centroid &lt;- st_centroid(comuna1_sf)
comuna1_bbox &lt;- st_bbox(comuna1_sf)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(comuna1_bbox[c(2,1,4,3)], collapse = ","), ")", " AND Banda='7'"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_comuna1 &lt;- read_sf(idecom_geoserver_url)

radiobases_4g_comuna1 &lt;- radiobases_4g_comuna1 %&gt;% 
  as_Spatial() %&gt;% 
  sp::remove.duplicates() %&gt;% 
  st_as_sf() %&gt;% 
  na.omit()

register_google(Sys.getenv("GOOGLE_MAPS_API_KEY"))
comuna1_map &lt;- get_googlemap(center = c(lon=-58.37869433449463, 
                                        lat=-34.606838945727), 
                             zoom = 15)

ggmap(comuna1_map, 
      base_layer = ggplot(data = na.omit(st_drop_geometry(radiobases_4g_comuna1)), 
                          aes(Longitud, Latitud))) +
  geom_path(stat = "voronoi", alpha = 0.6, size = 0.4) +
  geom_point(color = "blue", size = 0.7) +
  theme_minimal() +
  theme(axis.text = element_blank(),
        axis.title = element_blank())

```

&lt;center&gt;
![](radiobases_4g_comuna1_map.png){width=75%}
&lt;/center&gt;

## Día 4 - Hexágonos

Para graficar las radiobases 4G también se pueden utilizar hexágonos, utilizando la intesidad del color para mostrar la densidad de las mismas.

```{r, eval=FALSE}
library(hexbin)

ign_geoserver_base_url &lt;- "https://wms.ign.gob.ar/geoserver/ows"

ign_geoserver_query &lt;- list(service="wfs",
                            version="1.1.0",
                            request="GetFeature",
                            typeNames="ign:provincia",
                            CQL_FILTER="in1='02'")

ign_geoserver_url &lt;- modify_url(url = ign_geoserver_base_url,
                                query = ign_geoserver_query)
caba &lt;- read_sf(ign_geoserver_url)

caba_bb &lt;- st_bbox(caba)

idecom_geoserver_base_url &lt;- "https://www.idecom.gob.ar/geoserver/ows"

idecom_geoserver_query &lt;- list(service="wfs",
                               version="1.3.0",
                               request="GetFeature",
                               typeNames="publico:Antenas103-NO4G-5-3",
                               cql_filter=paste0("BBOX(the_geom,", paste(caba_bb[c(2,1,4,3)], collapse = ","), ")"))

idecom_geoserver_url &lt;- modify_url(url=idecom_geoserver_base_url, 
                                   query = idecom_geoserver_query)

radiobases_4g_caba &lt;- read_sf(idecom_geoserver_url)

if(st_crs(caba)!=st_crs(radiobases_4g_caba)) {
  radiobases_4g_caba &lt;- st_transform(radiobases_4g_caba, crs = st_crs(caba))
}
radiobases_4g_caba &lt;- st_join(radiobases_4g_caba, caba, left=FALSE)

caba %&gt;% 
  ggplot() +
  geom_sf() +
  geom_hex(data = radiobases_4g_caba, aes(Longitud, Latitud)) +
  theme_bw() +
  coord_sf(datum = NA) +
  scale_fill_viridis_c(direction = -1, name = "Radiobases 4G") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())

```

&lt;center&gt;
![](radiobases_4g_caba_map.png)
&lt;/center&gt;

[3]:https://es.wikipedia.org/wiki/Pol%C3%ADgonos_de_Thiessen
[5]:https://www.researchgate.net/publication/260297863_Mobile_Phone_Location_Area_Based_Traffic_Flow_Estimation_in_Urban_Road_Traffic
:::</code></pre>
</div>
</div>
</section>
<section id="cables-submarinos-de-internet" class="level2">
<h2 class="anchored" data-anchor-id="cables-submarinos-de-internet">Cables Submarinos De Internet</h2>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>posteos_ingles <span class="op">=</span> os.listdir(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/english/post/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>posteos_ingles <span class="op">=</span> posteos.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>posteos_ingles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<pre><code>['2022-02-06-internet-submarine-cables',
 '2022-02-07-price-evolution',
 '2022-03-19-using-satellite-images',
 '2022-04-12-internet-fix-access-dashboard-in-argentina',
 '2022-04-20-ict-companies-social-network-analysis',
 '2022-06-17-forum-equality-digital-divide',
 '2023-01-08-beckham-vs-papu-gomez']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>posteos_espanol <span class="op">=</span> os.listdir(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/spanish/post/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove 0,7,10,11</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>posteos_espanol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>['2022-02-06-cables-submarinos-de-internet',
 '2022-02-07-evoluci-n-de-los-precios',
 '2022-03-19-usando-im-genes-satelitales',
 '2022-04-12-tablero-de-accesos-fijos-a-internet-en-argentina',
 '2022-04-19-an-lisis-de-empresas-tic-en-redes-sociales',
 '2022-06-17-foro-brechas-y-equidad-digital',
 '2023-01-08-beckham-vs-papu-gomez']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fusionar_posteo(posteo_espanol, posteo_ingles):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ss">Te voy a pasar un posteo de un blog en español y en inglés y necesito que los fusiones de un modo particular. </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ss">El encabezado o YAML está demarcado por `---` al principio y al final. La idea es conservar un sólo encabezado, con el título en inglés y el subtítulo en español. </span><span class="ch">\</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="ss">Los textos entre cada bloque de código deben enmarcarse con `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span><span class="ss">` par el texto en español y `:::` y con `::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span><span class="ss">` y `:::` para el texto en inglés.  \ </span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ss">Cada bloque de código debe aparecer una sóla vez luego del texto en español e inglés. </span><span class="ch">\</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="ss">La estructura esperada es la siguiente: </span><span class="ch">\</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="ss">---</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="ss">title: Title in english</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="ss">subtitle: Título en español</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="ss">author: Martin Olmos</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="ss">...</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="ss">First text block in english. Should contain all text until the first code block.</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="ss">Primer bloque de texto en español. Debería contener todo el texto hasta el primer bloque de código.</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span><span class="sc">{</span>python<span class="sc">,</span> <span class="bu">eval</span><span class="op">=</span>FALSE<span class="sc">,</span> echo<span class="op">=</span>TRUE<span class="sc">}</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="ss">First code block</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="english"</span><span class="ch">}}</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="ss">Second text block in english. Should contain all text until the second code block.</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="ss">::: </span><span class="ch">{{</span><span class="ss">.content-visible when-profile="spanish"</span><span class="ch">}}</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="ss">Segundo bloque de texto en español. Debería contener todo el texto hasta el segundo bloque de código.</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span><span class="sc">{</span>python<span class="sc">,</span> <span class="bu">eval</span><span class="op">=</span>FALSE<span class="sc">,</span> echo<span class="op">=</span>TRUE<span class="sc">}</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="ss">Second code block</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="ss">```</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="ss">Ahora fusiona los siguientes posteos: </span><span class="ch">\</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en español: </span><span class="ch">\</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_espanol<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo en inglés: </span><span class="ch">\</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>posteo_ingles<span class="sc">}</span><span class="ss"> </span><span class="ch">\</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="ss">Posteo fusionado esperado: </span><span class="ch">\</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> get_completion(prompt)</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(posteos_ingles)):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/english/post/'</span> <span class="op">+</span> posteos_ingles[i] <span class="op">+</span> <span class="st">'/index.en.Rmd'</span>, <span class="st">'r'</span>) <span class="im">as</span> fi:</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>        posteo_ingles <span class="op">=</span> fi.read()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'/Users/martinolmos/Documents/datos_tic/content/spanish/post/'</span> <span class="op">+</span> posteos_espanol[i] <span class="op">+</span> <span class="st">'/index.es.Rmd'</span>, <span class="st">'r'</span>) <span class="im">as</span> fe:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        posteo_espanol <span class="op">=</span> fe.read()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> fusionar_posteo(posteo_espanol, posteo_ingles)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    folder <span class="op">=</span> re.sub(<span class="st">"\d</span><span class="sc">{4}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-"</span>, <span class="st">""</span>, posteos_ingles[i])</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    os.mkdir(<span class="st">'posts/'</span> <span class="op">+</span> folder)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'posts/'</span> <span class="op">+</span> folder <span class="op">+</span> <span class="st">'/index.qmd'</span>, <span class="st">'w'</span>) <span class="im">as</span> fw:</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        fw.write(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>re.sub(<span class="st">"\d</span><span class="sc">{4}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-\d</span><span class="sc">{2}</span><span class="st">-"</span>, <span class="st">""</span>, posteos_ingles[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<pre><code>'price-evolution'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'prueba.qmd'</span>, <span class="st">'w'</span>) <span class="im">as</span> fw:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    fw.write()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity data</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fechas <span class="op">=</span> [</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/09/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"BID: Consultor en Ciencia de Datos y TICs"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/03/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"BNMC: Consultor asociado"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/02/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"CAF: Consultor en Ciencia de Datos y TICs"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/07/2022"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"UNSAM: Docente en Gobierno Abierto y Nuevas Tecnologías"</span>, <span class="st">"Actividad docente"</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/06/2021"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"PELI: Docente en Nuevas Tecnologías"</span>, <span class="st">"Actividad docente"</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/04/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"ITBA: Maestría en Ciencia de Datos"</span>, <span class="st">"Formación académica"</span>),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"20/12/2019"</span>, <span class="st">"11/03/2022"</span>, <span class="st">"Subsecretario de TICs"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/08/2018"</span>, <span class="st">"31/07/2019"</span>, <span class="st">"ITBA: Especialización en Ciencia de Datos"</span>, <span class="st">"Formación académica"</span>),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/07/2018"</span>, <span class="st">"01/11/2019"</span>, <span class="st">"SUBE: Consultor en Ciencia de Datos"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/08/2018"</span>, <span class="st">"01/06/2019"</span>, <span class="st">"Muni San Miguel: Consultor en Ciencia de Datos"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/02/2018"</span>, <span class="st">"01/08/2018"</span>, <span class="st">"OPDS: Consultor en Ciencia de Datos"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/04/2017"</span>, <span class="st">"01/11/2019"</span>, <span class="st">"iCiudad: Director Ejecutivo"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/05/2015"</span>, <span class="st">"01/12/2016"</span>, <span class="st">"CAF: Consultor en Ciencia de Datos"</span>, <span class="st">"Experiencia profesional"</span>),</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"14/01/2015"</span>, <span class="st">"10/10/2016"</span>, <span class="st">"GWU: Master in Public Policy"</span>, <span class="st">"Formación académica"</span>),</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/11/2009"</span>, <span class="st">"01/12/2014"</span>, <span class="st">"ANSES: Jefe Regional de Ciudad de Buenos Aires"</span>, <span class="st">"Experiencia profesional"</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a color map that maps each category to a specific color</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Experiencia profesional"</span>: <span class="st">"lightskyblue"</span>,</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Actividad docente"</span>: <span class="st">"palegreen"</span>,</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Formación académica"</span>: <span class="st">"peachpuff"</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform string dates to datetime format</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>fechas_convertidas <span class="op">=</span> [(datetime.strptime(start, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>), datetime.strptime(end, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)) <span class="cf">for</span> start, end, _, _ <span class="kw">in</span> fechas]</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure and axis</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of patches to add to the legend</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>color, label<span class="op">=</span>label) <span class="cf">for</span> label, color <span class="kw">in</span> color_map.items()]</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the legend to the plot</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>patches)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Add each activity as a horizontal bar</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (start, end, label, category) <span class="kw">in</span> <span class="bu">enumerate</span>(fechas):</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> datetime.strptime(start, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> datetime.strptime(end, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    ax.barh(i, (end_date <span class="op">-</span> start_date).days, left<span class="op">=</span>start_date, color<span class="op">=</span>color_map[category], label<span class="op">=</span>label)</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Format dates in the x axis</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(mdates.YearLocator())</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legends and labels</span></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(fechas)))</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([label <span class="cf">for</span> _, _, label, _ <span class="kw">in</span> fechas])</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Año'</span>)</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Línea de Tiempo CV Martin Olmos'</span>)</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="migration_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity data</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>fechas <span class="op">=</span> [</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/09/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"IDB: Data Science and ICT Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/03/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"BNMC: Associate Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/02/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"CAF: Data Science and ICT Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/07/2022"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"UNSAM: Instructor in Open Government and New Technologies"</span>, <span class="st">"Teaching Activity"</span>),</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/06/2021"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"PELI: Instructor in New Technologies"</span>, <span class="st">"Teaching Activity"</span>),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/04/2023"</span>, <span class="st">"31/01/2024"</span>, <span class="st">"ITBA: Master's in Data Science"</span>, <span class="st">"Academic Training"</span>),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"20/12/2019"</span>, <span class="st">"11/03/2022"</span>, <span class="st">"Deputy Secretary of ICTs"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/08/2018"</span>, <span class="st">"31/07/2019"</span>, <span class="st">"ITBA: Specialization in Data Science"</span>, <span class="st">"Academic Training"</span>),</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/07/2018"</span>, <span class="st">"01/11/2019"</span>, <span class="st">"SUBE: Data Science Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/08/2018"</span>, <span class="st">"01/06/2019"</span>, <span class="st">"Muni San Miguel: Data Science Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/02/2018"</span>, <span class="st">"01/08/2018"</span>, <span class="st">"OPDS: Data Science Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/04/2017"</span>, <span class="st">"01/11/2019"</span>, <span class="st">"iCiudad: Executive Director"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/05/2015"</span>, <span class="st">"01/12/2016"</span>, <span class="st">"CAF: Data Science Consultant"</span>, <span class="st">"Professional Experience"</span>),</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"14/01/2015"</span>, <span class="st">"10/10/2016"</span>, <span class="st">"GWU: Master in Public Policy"</span>, <span class="st">"Academic Training"</span>),</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"01/11/2009"</span>, <span class="st">"01/12/2014"</span>, <span class="st">"ANSES: Regional Head of Buenos Aires City"</span>, <span class="st">"Professional Experience"</span>)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a color map that maps each category to a specific color</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Professional Experience"</span>: <span class="st">"lightskyblue"</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Teaching Activity"</span>: <span class="st">"palegreen"</span>,</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Academic Training"</span>: <span class="st">"peachpuff"</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform string dates to datetime format</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>fechas_convertidas <span class="op">=</span> [(datetime.strptime(start, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>), datetime.strptime(end, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)) <span class="cf">for</span> start, end, _, _ <span class="kw">in</span> fechas]</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure and axis</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of patches to add to the legend</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>color, label<span class="op">=</span>label) <span class="cf">for</span> label, color <span class="kw">in</span> color_map.items()]</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the legend to the plot</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>patches)</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Add each activity as a horizontal bar</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (start, end, label, category) <span class="kw">in</span> <span class="bu">enumerate</span>(fechas):</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>    start_date <span class="op">=</span> datetime.strptime(start, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> datetime.strptime(end, <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>    ax.barh(i, (end_date <span class="op">-</span> start_date).days, left<span class="op">=</span>start_date, color<span class="op">=</span>color_map[category], label<span class="op">=</span>label)</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Format dates in the x axis</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(mdates.YearLocator())</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legends and labels</span></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(fechas)))</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([label <span class="cf">for</span> _, _, label, _ <span class="kw">in</span> fechas])</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Martin Olmos CV Timeline'</span>)</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="migration_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>